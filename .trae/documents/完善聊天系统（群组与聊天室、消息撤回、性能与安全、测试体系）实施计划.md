## 目标与范围
- 完善群组与聊天室：提供独立入口、列表与详情 UI，支持成员管理与加入/退出。
- 消息撤回/删除、未读数实时同步与离线消息落盘：前后端联动补齐，客户端 UI/状态同步。
- 性能优化：虚拟滚动、大列表分页、图片/视频懒加载与预览优化。
- 安全与体验：敏感词过滤前端提示与服务端校验、表情包管理与常用表情。
- 测试体系：引入 Vitest/RTL 与 c8 覆盖率≥80%，补充 API/Socket 集成与 E2E（Playwright/Cypress）。

## 前端实现
### 导航与页面
- 侧边栏新增入口：群组管理（GroupInfo）、聊天室（ChatRoomList → ChatRoom）。
- 路由/选项卡：在 `src/App.jsx` 增加 `chat-group`→GroupInfo、`chat-room`→ChatRoomList/ChatRoom。

### 群组管理 UI
- `GroupInfo.jsx`：群信息卡片、成员列表（角色徽章）、公告编辑（管理员）、邀请/移除成员、退出群组/解散群组。
- 状态与数据流：使用 Axios 获取 `/api/chat/groups/:id`、列表 `/api/chat/groups`，操作 API：创建/更新/删除/成员邀请移除/角色设置。

### 聊天室 UI
- `ChatRoomList.jsx`：分类筛选、在线人数、创建聊天室按钮，列表分页加载。
- `ChatRoom.jsx`：房间信息、在线成员列表、聊天区域、进入/退出提示；加入/离开 `/api/chat/rooms/:id/join|leave`。

### 消息撤回/删除与未读同步
- 消息气泡右键/长按菜单：撤回/删除/转发/引用。
- 调用：撤回 `PUT /api/chat/messages/:id/recall`、删除 `DELETE /api/chat/messages/:id`。
- 未读数：
  - 选择会话后发 `message:read`，服务器广播会话成员未读更新事件 `conversation:unread:update`；客户端更新会话列表未读徽章。
  - 新消息到达时服务端发送 `message:receive` 与未读增量事件。
- 离线消息：客户端连接时发 `user:sync`，服务器返回离线消息队列，前端合并与状态重置。

### 性能优化
- 虚拟滚动：在 `ChatWindow` 消息列表引入 virtual list（如 react-window/react-virtualized）。
- 分页与批量渲染：上拉加载更多时增量渲染；滚动到底部按钮。
- 媒体懒加载：图片使用 `IntersectionObserver`（已有 `LazyImageRenderer` 可复用）；视频预览使用轻量封面与点击加载。

### 安全与表情
- 敏感词：
  - 前端提示：发送前本地敏感词检测（弱校验），给出替换/确认提示。
  - 服务端强校验：消息发送与编辑过滤（`server/utils/sensitiveWords.js` 可复用）。
- 表情包管理：在 `MessageInput` 增加表情选择器、常用表情收藏与搜索；预设 Emoji Mart 集成。

## 后端协作（对接与补齐）
- 群组 API：`POST/GET/PUT/DELETE /api/chat/groups`，成员管理 `POST/DELETE /api/chat/groups/:id/members`，角色设置与退出/解散。
- 聊天室 API：`POST/GET/PUT/DELETE /api/chat/rooms`，加入/退出 `POST /api/chat/rooms/:id/join|leave`。
- 消息撤回/删除：实现持久层更新并通过 Socket 广播事件 `message:recall`/`message:delete`。
- 未读数：在消息写入时更新 `message_status`，广播未读事件；读取时批量更新为已读并广播未读变更。
- 离线消息：登录/重连后根据 `message_status` 与时间窗口返回未读或离线消息。

## 测试体系
- 依赖与脚本：引入 `vitest`、`@testing-library/react`、`c8`；E2E 使用 `playwright` 或 `cypress`。
- 覆盖目标：≥80%（statements/branches/functions/lines）。
- 单元测试：
  - 组件：ConversationList/ChatWindow/MessageInput/消息组件（渲染、交互、菜单）。
  - Hooks/Utils：Socket 连接管理、敏感词检测、懒加载渲染。
- 集成测试：
  - API：群组/聊天室 CRUD、消息撤回/删除、搜索、收藏、未读更新。
  - Socket：消息收发、撤回/删除广播、未读事件、离线同步。
- E2E 流程：登录→进入聊天→选择会话→发送消息（文本/图片/文件）→撤回→查看未读同步→加入聊天室→退出聊天室。

## 交付项
- 前端：导航与页面接入、群组与聊天室 UI、消息撤回/删除交互、未读同步与离线同步、虚拟滚动与媒体懒加载、敏感词与表情。
- 测试：Vitest/RTL 单元/集成测试、E2E 脚本、覆盖率报告（c8 HTML 与文本）。
- 文档：更新聊天功能文档（用法、入口、API 对接、测试运行与覆盖率说明）。

## 验证与发布
- 本地验证：后端端口释放并重新启动；前端进入“聊天通讯”完成端到端操作路径。
- 测试跑通：`npm run test`、`npm run coverage`；输出覆盖率≥80%。
- 回归检查：边界（大消息量、媒体多、离线重连、权限不同角色）。

请确认上述计划，确认后我将开始分批实现并提交对应改动与测试。