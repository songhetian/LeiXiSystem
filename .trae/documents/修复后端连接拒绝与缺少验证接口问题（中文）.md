## 问题定位
- 前端多处请求报错 `net::ERR_CONNECTION_REFUSED`，目标均为 `http://localhost:3001`，说明后端端口未监听或进程退出。
- Token 定时验证调用 `GET /api/auth/verify-token`（src/hooks/useTokenVerification.js）但后端未实现该路由，仅有 `POST /api/auth/check-session`、`/api/auth/login`、`/api/auth/logout`。
- Socket.IO 客户端请求 `http://localhost:3001/socket.io` 同样拒绝，进一步佐证服务未在 3001 正常对外提供连接。

## 计划实施步骤
1. 确认后端服务监听状态
- 以单独方式启动后端（不依赖并行脚本），确保 `fastify.listen({ port: 3001, host: '0.0.0.0' })` 成功并打印监听日志。
- 保留并验证 Socket.IO 初始化日志（“Socket.IO initialized”），避免初始化前进程退出。

2. 实现 `GET /api/auth/verify-token`
- 在 `server/index.js` 添加路由：
  - 从 `Authorization: Bearer <token>` 读取并 `jwt.verify`。
  - 查询 `users.session_token` 比较：若当前 token 与数据库中的会话不一致，返回 `{ valid: false, kicked: true }`；一致且未过期返回 `{ valid: true }`；解析失败返回 `{ valid: false }`。
- 返回 JSON 结构与前端 Hook 期望一致：`{ valid: boolean, kicked?: boolean }`。

3. Socket.IO 与前端对齐
- 确保服务端初始化在 `fastify.listen` 成功之后进行。
- 前端连接 URL 指向 `http://localhost:3001`，与当前 `.env.local` 中 API 基址保持一致（已设置为 `http://localhost:3001/api`）。

4. 运行与验证
- 启动后端并观察日志无错误。
- 启动前端（Vite）并在页面触发：
  - `GET /api/auth/verify-token`：登录态有效返回 `valid: true`；无效或被踢返回相应标志。
  - 业务接口如 `/api/departments`、`/api/employees`、`/api/positions`、`/api/roles` 正常返回。
  - Socket.IO 无 xhr poll 错误，连接成功。

## 注意事项
- 若仍出现连接拒绝，检查是否有并行脚本导致服务被终止（例如并发启动时某子进程异常退出）。
- 若需要继续使用内网 IP（生产/联调），将 `.env.local` 改为目标地址，并确保防火墙与端口开放。

## 交付
- 新增 `GET /api/auth/verify-token` 路由实现。
- 保持并确认后端启动与 Socket.IO 初始化，确保前端调用不再拒绝连接。