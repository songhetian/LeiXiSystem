# 🔥 热更新说明

## 概述

项目已配置热更新（Hot Reload），大部分代码修改后会自动生效，无需重启。

## ✅ 自动热更新的部分

### 1. React 前端代码（推荐开发）

**自动热更新** - 修改后立即生效，浏览器自动刷新

**支持的文件：**
- `src/components/*.jsx` - React 组件
- `src/App.jsx` - 主应用
- `src/api/index.js` - API 接口
- `src/index.css` - 全局样式
- `tailwind.config.js` - Tailwind 配置

**技术：** Vite HMR (Hot Module Replacement)

**体验：**
```
修改代码 → 保存 → 自动刷新 → 立即看到效果 ✨
```

### 2. Fastify 后端代码（已配置）

**自动热更新** - 修改后自动重启服务器

**支持的文件：**
- `server/index.js` - API 路由
- `server/config.js` - 配置文件
- `.env` - 环境变量

**技术：** Nodemon

**体验：**
```
修改代码 → 保存 → 自动重启 → 2秒后生效 ✨
```

**控制台输出：**
```
[nodemon] restarting due to changes...
[nodemon] starting `node server/index.js`
数据库连接池创建成功
Fastify 服务器运行在 http://localhost:3001
```

## ❌ 需要手动重启的部分

### 1. Electron 主进程

**需要手动重启** - Electron 主进程不支持热更新

**需要重启的文件：**
- `electron/main.js` - 主进程
- `electron/preload.js` - 预加载脚本

**重启方式：**
1. 关闭 Electron 窗口
2. 在终端按 `Ctrl+C` 停止进程
3. 重新运行 `npm run dev`

### 2. 配置文件（部分）

**需要重启的配置：**
- `vite.config.js` - Vite 配置
- `package.json` - 依赖和脚本
- `nodemon.json` - Nodemon 配置

## 🚀 开发工作流

### 前端开发（最佳体验）

```bash
# 启动开发服务器
npm run dev

# 修改 src/ 下的文件
# 保存后自动刷新，立即看到效果 ✨
```

### 后端开发（自动重启）

```bash
# 启动开发服务器（已包含 nodemon）
npm run dev

# 修改 server/ 下的文件
# 保存后自动重启，2秒后生效 ✨
```

### 全栈开发

```bash
# 同时开发前后端
npm run dev

# 前端修改 → 自动刷新
# 后端修改 → 自动重启
# 无需手动操作 ✨
```

## 📝 热更新详细说明

### React 前端热更新

**工作原理：**
1. Vite 监听文件变化
2. 检测到修改后，只更新改变的模块
3. 保持应用状态，无需刷新整个页面

**优点：**
- ⚡ 极快的更新速度（毫秒级）
- 🎯 保持组件状态
- 🔄 只更新修改的部分

**示例：**
```jsx
// 修改前
<button className="bg-blue-500">点击</button>

// 修改后（保存即生效）
<button className="bg-green-500">点击</button>
```

### Fastify 后端热更新

**工作原理：**
1. Nodemon 监听 server/ 文件夹
2. 检测到修改后，自动重启 Node.js 进程
3. 重新加载所有模块

**优点：**
- 🔄 自动重启服务器
- 📝 监听多个文件和文件夹
- ⚙️ 可配置监听规则

**配置文件：** `nodemon.json`
```json
{
  "watch": ["server/**/*", ".env"],
  "ext": "js,json",
  "ignore": ["node_modules/**/*", "tests/**/*"]
}
```

## 🔧 配置说明

### Nodemon 配置

**文件：** `nodemon.json`

```json
{
  "watch": ["server/**/*", ".env"],     // 监听的文件夹
  "ext": "js,json",                     // 监听的文件扩展名
  "ignore": ["node_modules/**/*"],      // 忽略的文件夹
  "exec": "node server/index.js"        // 执行的命令
}
```

**自定义监听：**
```json
{
  "watch": ["server", "database"],      // 监听多个文件夹
  "ext": "js,json,sql",                 // 监听 SQL 文件
  "delay": 2000                         // 延迟 2 秒重启
}
```

### Vite 配置

**文件：** `vite.config.js`

```javascript
export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    hmr: true  // 启用热更新
  }
})
```

## 💡 开发技巧

### 1. 快速开发前端

```bash
# 只启动前端（不启动 Electron）
npm run dev:react

# 在浏览器中打开 http://localhost:5173
# 修改代码，立即看到效果
```

### 2. 快速开发后端

```bash
# 只启动后端（带热更新）
npm run dev:server

# 修改 server/ 代码，自动重启
```

### 3. 调试时禁用热更新

```bash
# 使用普通模式启动后端（不自动重启）
npm run dev:server:normal
```

## 🐛 常见问题

### 问题 1：后端修改后没有自动重启

**原因：** Nodemon 没有监听到文件变化

**解决：**
1. 检查 `nodemon.json` 配置
2. 确认文件在监听范围内
3. 手动重启：`Ctrl+C` 然后 `npm run dev:server`

### 问题 2：前端修改后没有自动刷新

**原因：** Vite HMR 连接断开

**解决：**
1. 刷新浏览器
2. 检查控制台错误
3. 重启开发服务器

### 问题 3：修改 .env 后没有生效

**原因：** 环境变量需要重启才能加载

**解决：**
1. Nodemon 会自动重启后端
2. 前端需要手动刷新浏览器
3. Electron 需要完全重启

## 📊 性能对比

| 操作 | 无热更新 | 有热更新 | 提升 |
|------|---------|---------|------|
| 前端修改 | 10秒 | 0.5秒 | 20倍 ⚡ |
| 后端修改 | 5秒 | 2秒 | 2.5倍 🚀 |
| 样式修改 | 10秒 | 0.1秒 | 100倍 ✨ |

## 🎯 最佳实践

1. **前端开发** - 充分利用 Vite HMR，修改即生效
2. **后端开发** - 使用 Nodemon，自动重启
3. **调试时** - 可以禁用热更新，使用普通模式
4. **生产环境** - 不使用热更新，使用构建后的代码

## 📚 相关文档

- [Vite HMR API](https://vitejs.dev/guide/api-hmr.html)
- [Nodemon 文档](https://nodemon.io/)
- [React Fast Refresh](https://github.com/facebook/react/tree/main/packages/react-refresh)

---

**提示：** 热更新大大提高了开发效率，建议充分利用！🚀
