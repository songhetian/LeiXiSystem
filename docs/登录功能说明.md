# 登录注册功能说明

## 功能概述

系统已实现完整的登录注册功能，用户必须登录后才能访问主系统。

## ✨ 功能特性

### 1. 用户注册
- 📝 注册表单包含：真实姓名、用户名、邮箱、手机号、密码
- 🔐 密码使用 bcrypt 加密存储
- ✅ 自动检查用户名是否重复
- 🎯 注册成功后自动切换到登录页面

### 2. 用户登录
- 🔑 使用用户名和密码登录
- 🎫 登录成功后生成 JWT token
- 💾 Token 和用户信息保存在 localStorage
- ⏰ Token 有效期 7 天
- 🚫 账户状态检查（禁用账户无法登录）

### 3. 会话管理
- 🔄 自动检查本地存储的登录状态
- 🚪 退出登录清除本地数据
- 🔒 未登录自动跳转到登录页面

## 🎨 界面设计

### 登录页面
- 渐变绿色背景
- 居中白色卡片
- Logo 和系统名称
- 登录/注册切换标签
- 测试账号提示

### 主系统
- 左侧层级菜单导航
- 顶部显示用户信息
- 退出登录按钮

## 📋 层级菜单结构

根据功能介绍文档，菜单分为 5 个主模块：

### 1. 👥 用户管理
- 用户账户管理
- 权限管理

### 2. 🏢 组织架构
- 部门管理
- 职位管理
- 员工管理

### 3. 💬 聊天通讯
- 即时通讯
- 群组管理

### 4. ⏰ 考勤管理
- 班次管理
- 排班管理
- 考勤打卡
- 请假管理

### 5. 📊 质检管理
- 质检会话
- 质检规则
- 质检评分
- 质检报告

## 🔧 技术实现

### 前端
- **登录页面**: `src/pages/Login.jsx`
- **层级菜单**: `src/components/Sidebar.jsx`
- **主应用**: `src/App.jsx`
- **占位页面**: `src/components/ComingSoon.jsx`

### 后端
- **注册 API**: `POST /api/auth/register`
- **登录 API**: `POST /api/auth/login`
- **密码加密**: bcrypt
- **Token 生成**: jsonwebtoken

### 数据库
- **用户表**: users
- **字段**: username, password_hash, real_name, email, phone, status

## 🚀 使用方式

### 测试账号
```
用户名: zhangsan
密码: 123456
```

### 注册新用户
1. 点击"注册"标签
2. 填写完整信息
3. 点击"注册"按钮
4. 注册成功后自动切换到登录

### 登录系统
1. 输入用户名和密码
2. 点击"登录"按钮
3. 登录成功进入主系统

### 退出登录
1. 点击左下角"退出登录"按钮
2. 自动清除登录状态
3. 返回登录页面

## 📊 API 接口

### 注册接口
```
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "123456",
  "real_name": "测试用户",
  "email": "test@example.com",
  "phone": "13800138000"
}

Response:
{
  "success": true,
  "message": "注册成功",
  "userId": 1
}
```

### 登录接口
```
POST /api/auth/login
Content-Type: application/json

{
  "username": "zhangsan",
  "password": "123456"
}

Response:
{
  "success": true,
  "message": "登录成功",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "zhangsan",
    "real_name": "张三",
    "email": "zhangsan@company.com",
    "phone": "13800138001",
    "status": "active"
  }
}
```

## 🔐 安全特性

1. **密码加密**: 使用 bcrypt 加密，不存储明文密码
2. **JWT Token**: 使用 JWT 进行身份验证
3. **Token 过期**: 7 天后自动过期
4. **状态检查**: 禁用账户无法登录
5. **本地存储**: Token 存储在 localStorage

## 🎯 已实现功能

- ✅ 用户注册
- ✅ 用户登录
- ✅ 退出登录
- ✅ 会话保持
- ✅ 层级菜单
- ✅ 用户信息显示
- ✅ 登录状态检查

## 🚧 待开发功能

- ⏳ 忘记密码
- ⏳ 修改密码
- ⏳ 个人资料编辑
- ⏳ 权限控制
- ⏳ 角色管理
- ⏳ 其他模块功能

## 💡 开发建议

### 添加新页面
1. 在 `src/pages/` 创建新组件
2. 在 `App.jsx` 的 `renderContent()` 中添加路由
3. 更新菜单项的 `id` 对应

### 添加权限控制
```javascript
// 在需要权限的 API 中使用
fastify.get('/api/protected', { preHandler: verifyToken }, async (request, reply) => {
  // request.user 包含解码后的用户信息
  return { message: '这是受保护的资源' }
})
```

### 前端携带 Token
```javascript
axios.get('/api/protected', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
})
```

## 📝 注意事项

1. **首次使用**: 需要先注册账号或使用测试账号
2. **Token 过期**: 7 天后需要重新登录
3. **退出登录**: 会清除本地所有登录信息
4. **占位页面**: 部分功能显示"Coming Soon"

## 🔄 更新日志

### v1.0.0 (2024-11-09)
- ✅ 实现用户注册功能
- ✅ 实现用户登录功能
- ✅ 实现退出登录功能
- ✅ 实现层级菜单导航
- ✅ 实现登录状态检查
- ✅ 添加用户信息显示

---

**提示**: 登录后才能访问系统功能，请先注册或使用测试账号登录。
