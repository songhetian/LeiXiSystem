# 学习计划功能改进说明

## 概述
本文档说明了对学习计划功能的改进，包括实现文档在线预览、进度记录、移除关联知识库文章功能以及拖拽排序等特性。

## 功能改进详情

### 1. 文档在线预览功能
- 在学习计划详情页面添加了文档预览功能
- 用户可以点击"预览文章"按钮查看关联的知识库文章内容
- 实现了预览模态框，展示文章的完整内容、摘要、作者信息等

### 2. 进度记录功能
- 将简单的"完成"按钮替换为进度记录功能
- 为每个关联文章的学习计划项目添加了进度条
- 用户可以通过 +/- 按钮调整学习进度（0-100%）
- 当进度达到100%时，显示"标记为完成"按钮
- 后端 API 支持进度字段的更新和验证

### 3. 移除关联知识库文章功能
- 在学习计划项目编辑页面中移除了关联知识库文章的输入框和选择器
- 简化了表单界面，只保留必要的字段

### 4. 拖拽排序功能
- 使用 HTML5 Drag and Drop API 实现了学习计划项目的拖拽排序
- 用户可以通过拖拽项目来重新排列学习计划的顺序
- 自动保存新的排序到数据库

## 技术实现

### 前端组件修改
文件：`src/components/LearningPlanDetails.jsx`

主要修改包括：
- 移除了与知识库文章关联相关的状态和函数
- 添加了拖拽排序相关的状态和事件处理函数
- 实现了进度控制组件和相关函数
- 添加了文档预览模态框
- 移除了编辑表单中的关联文章字段
- 移除了排序数字输入框

### 后端 API 修改
文件：`server/routes/learning-plans.js`

主要修改包括：
- 在更新学习计划项目接口中添加了对进度字段的支持
- 添加了进度值的验证（0-100范围）
- 修改了获取学习计划详情的查询，明确列出所有字段

### 数据库修改
文件：`database/migrations/004_add_learning_plan_details_progress.sql`

主要修改包括：
- 为 `learning_plan_details` 表添加了 `progress` 字段
- 添加了进度字段的索引以优化查询性能

## 使用说明

### 文档预览
1. 在学习计划详情页面，找到关联了知识库文章的项目
2. 点击"预览文章"链接
3. 在弹出的模态框中查看文章内容

### 进度记录
1. 对于关联了知识库文章的学习计划项目，会显示进度控制组件
2. 使用 +/- 按钮调整进度值
3. 进度会自动保存到数据库
4. 当进度达到100%时，点击"标记为完成"按钮将项目状态设置为已完成

### 拖拽排序
1. 在学习计划项目列表中，每个项目前面显示拖拽手柄（☰）
2. 点住拖拽手柄并移动项目到新位置
3. 释放鼠标以保存新的排序

## 注意事项
- 需要手动执行数据库迁移脚本 `004_add_learning_plan_details_progress.sql` 来添加进度字段
- 进度功能仅对关联了知识库文章的学习计划项目可见
- 传统的"完成"按钮仅对未关联文章的项目可见
