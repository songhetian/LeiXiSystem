# ⚠️ 员工审核页面 - 需要重启服务器

## 问题说明

员工审核页面无法显示数据，原因是：
- ✅ 前端代码正常（EmployeeApproval.jsx）
- ✅ 后端API已存在（/api/users-pending）
- ❌ 服务器未重启，新的API路由未加载

## 解决方案

### 方法1：重启服务器（推荐）

1. **停止当前服务器**
   - 在运行服务器的终端按 `Ctrl+C`

2. **重新启动服务器**
   ```bash
   npm run dev
   ```
   或者
   ```bash
   npm start
   ```

3. **验证服务器启动成功**
   - 看到 "Server listening at http://0.0.0.0:3001" 表示成功

### 方法2：使用热更新模式（开发推荐）

如果经常修改后端代码，建议使用 nodemon 自动重启：

```bash
npm run dev:server
```

这样修改服务器代码后会自动重启，无需手动操作。

## 测试API

重启服务器后，可以运行测试脚本验证：

```bash
node test-approval-api.js
```

应该看到类似输出：
```
✅ API响应成功
📊 待审核用户数量: 0
💡 提示: 当前没有待审核的用户
```

## 创建测试数据

如果需要测试审核功能，可以手动创建待审核用户：

### 方法1：通过数据库

```sql
-- 插入一个待审核用户
INSERT INTO users (username, password_hash, real_name, email, phone, status, created_at)
VALUES (
  'test_pending',
  '$2b$10$abcdefghijklmnopqrstuvwxyz',  -- 随机密码hash
  '测试待审核用户',
  'test@example.com',
  '13800138000',
  'pending',
  NOW()
);
```

### 方法2：修改现有用户状态

```sql
-- 将某个用户改为待审核状态
UPDATE users SET status = 'pending' WHERE id = 某个用户ID;
```

### 方法3：修改注册流程

在 `server/index.js` 的注册API中，将默认状态改为 `pending`：

```javascript
// 找到注册API（约第60行）
fastify.post('/api/auth/register', async (request, reply) => {
  // ...
  const [result] = await pool.query(
    'INSERT INTO users (..., status) VALUES (?, ?, ?, ?, ?, ?)',
    [username, passwordHash, real_name, email, phone, 'pending']  // 改为 pending
  )
  // ...
})
```

## 使用审核功能

重启服务器并有待审核用户后：

1. **访问审核页面**
   - 点击侧边栏 "员工管理 > 员工审核"

2. **查看待审核列表**
   - 显示所有状态为 `pending` 的用户
   - 可以按姓名、部门、日期筛选

3. **审核操作**
   - 点击"审核"按钮查看用户详情
   - 选择"通过"或"拒绝"
   - 填写审核备注（拒绝时必填）

4. **审核结果**
   - 通过：用户状态变为 `active`，可以正常登录
   - 拒绝：用户状态变为 `inactive`，无法登录

## 常见问题

### Q1: 重启后还是404？

检查：
1. 确认服务器完全停止（没有其他进程占用3001端口）
2. 确认启动的是正确的项目目录
3. 查看服务器启动日志是否有错误

### Q2: 页面显示"暂无待审核用户"？

这是正常的，说明：
- ✅ API工作正常
- ✅ 前端正常
- 💡 只是没有待审核的用户数据

可以按上面的方法创建测试数据。

### Q3: 如何批量审核？

当前版本是单个审核，如需批量审核功能，需要：
1. 修改前端添加批量选择
2. 添加批量审核API
3. 修改数据库操作支持批量更新

## 下一步

重启服务器后，员工审核功能就可以正常使用了！

---

**创建时间**: 2024-11-09
**状态**: 等待服务器重启
