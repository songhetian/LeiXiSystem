# 职位下拉框功能说明

## 功能概述

职位字段已从文本输入框改为下拉选择框，并实现了根据选择的部门动态加载对应职位的功能。

---

## 功能特点

### 1. ✅ 职位下拉选择
- 职位改为下拉框选择
- 不再需要手动输入
- 避免输入错误和不规范

### 2. ✅ 部门职位联动
- 选择部门后，职位列表自动筛选
- 只显示该部门的职位
- 未选择部门时，职位框禁用

### 3. ✅ 智能提示
- 未选择部门时提示"请先选择部门"
- 职位框显示为禁用状态
- 用户体验友好

### 4. ✅ 自动清空
- 切换部门时，自动清空已选职位
- 避免职位与部门不匹配
- 确保数据一致性

---

## 使用流程

### 添加/编辑员工时

```
1. 选择部门
   ↓
2. 职位下拉框激活
   ↓
3. 显示该部门的职位列表
   ↓
4. 选择职位
   ↓
5. 保存
```

### 示例场景

#### 场景1：添加技术部员工
```
1. 选择部门：技术部
2. 职位选项：技术总监、高级工程师、工程师、初级工程师
3. 选择：高级工程师
```

#### 场景2：添加销售部员工
```
1. 选择部门：销售部
2. 职位选项：销售总监、销售经理、销售代表
3. 选择：销售经理
```

#### 场景3：切换部门
```
1. 已选：技术部 - 高级工程师
2. 切换部门：销售部
3. 职位自动清空
4. 重新选择：销售经理
```

---

## 技术实现

### 状态管理

```javascript
const [positions, setPositions] = useState([])           // 所有职位
const [filteredPositions, setFilteredPositions] = useState([])  // 筛选后的职位
```

### 获取职位列表

```javascript
const fetchPositions = async () => {
  try {
    const response = await fetch('http://localhost:3001/api/positions')
    const data = await response.json()
    setPositions(data.filter(p => p.status === 'active'))
  } catch (error) {
    console.error('获取职位列表失败')
  }
}
```

### 部门职位联动

```javascript
// 根据部门筛选职位
useEffect(() => {
  if (formData.department_id) {
    const filtered = positions.filter(p =>
      !p.department_id || p.department_id === parseInt(formData.department_id)
    )
    setFilteredPositions(filtered)
  } else {
    setFilteredPositions(positions)
  }
}, [formData.department_id, positions])
```

### 部门改变处理

```javascript
// 部门改变时清空职位选择
const handleDepartmentChange = (departmentId) => {
  setFormData({
    ...formData,
    department_id: departmentId,
    position: '' // 清空职位
  })
}
```

### 职位下拉框

```jsx
<select
  value={formData.position}
  onChange={(e) => setFormData({ ...formData, position: e.target.value })}
  className="w-full px-3 py-2 border border-gray-300 rounded-lg"
  disabled={!formData.department_id}  // 未选部门时禁用
>
  <option value="">请选择职位</option>
  {filteredPositions.map(pos => (
    <option key={pos.id} value={pos.name}>{pos.name}</option>
  ))}
</select>
{!formData.department_id && (
  <p className="text-xs text-gray-500 mt-1">请先选择部门</p>
)}
```

---

## 数据库设计

### positions 表结构

```sql
CREATE TABLE `positions` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(50) NOT NULL COMMENT '职位名称',
  `level` VARCHAR(20) DEFAULT NULL COMMENT '职位级别',
  `department_id` INT(11) DEFAULT NULL COMMENT '所属部门ID',
  `salary_min` DECIMAL(10,2) DEFAULT NULL COMMENT '最低薪资',
  `salary_max` DECIMAL(10,2) DEFAULT NULL COMMENT '最高薪资',
  `description` TEXT DEFAULT NULL COMMENT '职位描述',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 职位与部门关联

- `department_id` 为 NULL：通用职位（所有部门可用）
- `department_id` 有值：专属职位（仅该部门可用）

### 示例数据

```sql
-- 技术部职位
INSERT INTO positions (name, level, department_id) VALUES
('技术总监', 'senior', 1),
('高级工程师', 'senior', 1),
('工程师', 'middle', 1),
('初级工程师', 'junior', 1);

-- 销售部职位
INSERT INTO positions (name, level, department_id) VALUES
('销售总监', 'senior', 2),
('销售经理', 'middle', 2),
('销售代表', 'junior', 2);

-- 通用职位（所有部门可用）
INSERT INTO positions (name, level, department_id) VALUES
('实习生', 'intern', NULL),
('助理', 'junior', NULL);
```

---

## 界面效果

### 未选择部门时

```
┌─────────────────────────────────┐
│ 所属部门: [请选择部门 ▼]        │
│ 职位: [请选择职位 ▼] (禁用)     │
│       请先选择部门               │
└─────────────────────────────────┘
```

### 选择技术部后

```
┌─────────────────────────────────┐
│ 所属部门: [技术部 ▼]            │
│ 职位: [请选择职位 ▼]            │
│       - 技术总监                 │
│       - 高级工程师               │
│       - 工程师                   │
│       - 初级工程师               │
└─────────────────────────────────┘
```

### 选择销售部后

```
┌─────────────────────────────────┐
│ 所属部门: [销售部 ▼]            │
│ 职位: [请选择职位 ▼]            │
│       - 销售总监                 │
│       - 销售经理                 │
│       - 销售代表                 │
└─────────────────────────────────┘
```

---

## 优势分析

### 1. 数据规范性
- ✅ 职位名称统一
- ✅ 避免拼写错误
- ✅ 便于统计分析

### 2. 用户体验
- ✅ 操作简单直观
- ✅ 不需要记忆职位名称
- ✅ 减少输入错误

### 3. 数据一致性
- ✅ 职位与部门匹配
- ✅ 自动清空不匹配的职位
- ✅ 确保数据准确

### 4. 管理便捷
- ✅ 集中管理职位
- ✅ 易于添加新职位
- ✅ 易于修改职位信息

---

## 职位管理

### 添加新职位

1. 进入"组织架构" → "职位管理"
2. 点击"添加职位"
3. 填写职位信息：
   - 职位名称
   - 职位级别
   - 所属部门（可选）
   - 薪资范围
4. 保存

### 编辑职位

1. 在职位管理页面找到职位
2. 点击"编辑"
3. 修改信息
4. 保存

### 删除职位

1. 在职位管理页面找到职位
2. 点击"删除"
3. 确认删除

---

## 注意事项

### 1. 职位与部门关联
- 创建职位时可以指定部门
- 不指定部门的职位为通用职位
- 通用职位在所有部门都可选

### 2. 职位状态
- 只有"启用"状态的职位才会显示
- "停用"的职位不会出现在下拉框中

### 3. 数据迁移
- 现有员工的职位数据保持不变
- 新增/编辑员工时使用下拉框
- 建议逐步规范化职位名称

### 4. 职位名称
- 建议使用标准职位名称
- 避免过于细分
- 便于统计和管理

---

## 扩展功能（可选）

### 1. 职位级别显示
```jsx
<option value={pos.name}>
  {pos.name} {pos.level && `(${pos.level})`}
</option>
```

### 2. 薪资范围提示
```jsx
<option value={pos.name}>
  {pos.name}
  {pos.salary_min && pos.salary_max &&
    ` (${pos.salary_min}-${pos.salary_max})`
  }
</option>
```

### 3. 职位描述提示
```jsx
<select title={selectedPosition?.description}>
  {/* 选项 */}
</select>
```

### 4. 快速添加职位
```jsx
<div className="flex gap-2">
  <select>...</select>
  <button onClick={openAddPositionModal}>
    + 新增
  </button>
</div>
```

---

## 相关API

### 获取职位列表
```
GET /api/positions
```

### 获取部门的职位
```
GET /api/positions?department_id=1
```

### 创建职位
```
POST /api/positions
Body: {
  name: "高级工程师",
  level: "senior",
  department_id: 1,
  salary_min: 15000,
  salary_max: 25000
}
```

---

## 相关文件

- `src/components/EmployeeManagement.jsx` - 员工管理组件（已修改）
- `server/index.js` - 后端API（已有职位接口）
- `database/init.sql` - 数据库结构（已有positions表）

---

## 测试建议

### 测试场景

1. **测试部门职位联动**
   - 选择技术部，应显示技术部职位
   - 选择销售部，应显示销售部职位
   - 切换部门，职位应自动清空

2. **测试职位禁用**
   - 未选择部门时，职位框应禁用
   - 选择部门后，职位框应启用

3. **测试通用职位**
   - 创建不指定部门的职位
   - 所有部门都应能看到该职位

4. **测试保存**
   - 选择部门和职位后保存
   - 刷新页面，数据应正确显示

---

**更新时间**：2024-11-09
**版本**：v2.6.0
