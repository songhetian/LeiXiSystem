# 搜索筛选部门职位联动功能说明

## 功能概述

搜索筛选区的职位下拉框现在会根据选择的部门动态显示对应的职位列表。

---

## 功能特点

### ✅ 部门职位联动
- 选择部门后，职位列表自动筛选
- 只显示该部门的职位
- 未选择部门时，职位框禁用

### ✅ 自动清空
- 切换部门时，自动清空已选职位
- 避免职位与部门不匹配
- 确保筛选准确性

### ✅ 智能提示
- 未选择部门时提示"请先选择部门"
- 职位框显示为禁用状态
- 用户体验友好

---

## 使用流程

### 搜索筛选时

```
1. 选择部门（如：技术部）
   ↓
2. 职位下拉框激活
   ↓
3. 显示技术部的职位列表
   ↓
4. 选择职位（如：高级工程师）
   ↓
5. 显示筛选结果
```

### 示例场景

#### 场景1：查找技术部的工程师
```
1. 部门：选择"技术部"
2. 职位选项：技术总监、高级工程师、工程师、初级工程师
3. 职位：选择"工程师"
4. 结果：显示技术部的所有工程师
```

#### 场景2：查找销售部的销售经理
```
1. 部门：选择"销售部"
2. 职位选项：销售总监、销售经理、销售代表
3. 职位：选择"销售经理"
4. 结果：显示销售部的所有销售经理
```

#### 场景3：切换部门
```
1. 已选：技术部 - 工程师
2. 切换部门：销售部
3. 职位自动清空
4. 重新选择：销售经理
```

---

## 技术实现

### 状态管理

```javascript
const [searchFilteredPositions, setSearchFilteredPositions] = useState([])
```

### 搜索筛选的职位联动

```javascript
// 根据部门筛选职位（搜索筛选用）
useEffect(() => {
  if (searchFilters.department) {
    const filtered = positions.filter(p =>
      !p.department_id || p.department_id === parseInt(searchFilters.department)
    )
    setSearchFilteredPositions(filtered)
  } else {
    setSearchFilteredPositions(positions)
  }
}, [searchFilters.department, positions])
```

### 部门改变处理

```javascript
// 部门改变时清空职位选择（搜索筛选）
const handleSearchDepartmentChange = (departmentId) => {
  setSearchFilters({
    ...searchFilters,
    department: departmentId,
    position: '' // 清空职位
  })
}
```

### 职位下拉框

```jsx
<select
  value={searchFilters.position}
  onChange={(e) => handleSearchChange('position', e.target.value)}
  className="w-full px-3 py-2 border border-gray-300 rounded-lg"
  disabled={!searchFilters.department}  // 未选部门时禁用
>
  <option value="">全部职位</option>
  {searchFilteredPositions.map(pos => (
    <option key={pos.id} value={pos.name}>{pos.name}</option>
  ))}
</select>
{!searchFilters.department && (
  <p className="text-xs text-gray-500 mt-1">请先选择部门</p>
)}
```

---

## 界面效果

### 未选择部门时

```
┌─────────────────────────────────────────────────────┐
│ 部门: [全部部门 ▼]                                  │
│ 职位: [全部职位 ▼] (禁用)                           │
│       请先选择部门                                   │
└─────────────────────────────────────────────────────┘
```

### 选择技术部后

```
┌─────────────────────────────────────────────────────┐
│ 部门: [技术部 ▼]                                    │
│ 职位: [全部职位 ▼]                                  │
│       - 技术总监                                     │
│       - 高级工程师                                   │
│       - 工程师                                       │
│       - 初级工程师                                   │
└─────────────────────────────────────────────────────┘
```

### 选择销售部后

```
┌─────────────────────────────────────────────────────┐
│ 部门: [销售部 ▼]                                    │
│ 职位: [全部职位 ▼]                                  │
│       - 销售总监                                     │
│       - 销售经理                                     │
│       - 销售代表                                     │
└─────────────────────────────────────────────────────┘
```

---

## 两处联动对比

### 1. 表单中的联动（添加/编辑员工）
- 用途：创建或编辑员工时选择职位
- 状态：`filteredPositions`
- 触发：`handleDepartmentChange`

### 2. 搜索筛选中的联动
- 用途：筛选员工列表
- 状态：`searchFilteredPositions`
- 触发：`handleSearchDepartmentChange`

### 两者独立工作
- 表单和搜索筛选互不影响
- 各自维护自己的状态
- 逻辑相同但独立

---

## 优势分析

### 1. 精确筛选
- ✅ 避免选择不存在的职位
- ✅ 确保部门职位匹配
- ✅ 提高筛选准确性

### 2. 用户体验
- ✅ 操作逻辑清晰
- ✅ 减少无效选择
- ✅ 提示信息友好

### 3. 数据一致性
- ✅ 职位与部门对应
- ✅ 自动清空不匹配项
- ✅ 避免数据错误

---

## 使用建议

### 推荐流程
1. 先选择部门
2. 再选择职位
3. 可添加其他筛选条件
4. 查看筛选结果

### 快速筛选
- 只选部门：查看该部门所有员工
- 部门+职位：查看该部门特定职位的员工
- 部门+职位+状态：更精确的筛选

---

## 注意事项

### 1. 通用职位
- `department_id` 为 NULL 的职位
- 在所有部门都可见
- 例如：实习生、助理

### 2. 职位状态
- 只显示启用状态的职位
- 停用的职位不会出现

### 3. 切换部门
- 切换部门会清空职位选择
- 需要重新选择职位
- 这是为了确保数据准确

### 4. 清除筛选
- 点击"清除筛选"会重置所有条件
- 包括部门和职位
- 恢复到初始状态

---

## 相关修改

### 前端组件
- `src/components/EmployeeManagement.jsx`
  - ✅ 添加 `searchFilteredPositions` 状态
  - ✅ 添加搜索筛选的职位联动逻辑
  - ✅ 添加 `handleSearchDepartmentChange` 函数
  - ✅ 修改部门下拉框使用新的处理函数
  - ✅ 修改职位下拉框支持禁用和提示

---

## 测试建议

### 测试场景

1. **测试职位联动**
   - 选择技术部，应显示技术部职位
   - 选择销售部，应显示销售部职位
   - 切换部门，职位应自动清空

2. **测试职位禁用**
   - 未选择部门时，职位框应禁用
   - 选择部门后，职位框应启用
   - 应显示提示文字

3. **测试筛选结果**
   - 选择部门和职位后，结果应准确
   - 只显示匹配的员工
   - 数量统计应正确

4. **测试清除筛选**
   - 点击清除筛选
   - 部门和职位都应重置
   - 显示所有员工

---

**更新时间**：2024-11-09
**版本**：v2.8.0
