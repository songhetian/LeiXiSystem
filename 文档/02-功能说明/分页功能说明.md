# 分页功能说明

## 功能概述

员工管理页面已添加完整的分页功能，支持自定义每页显示数量和灵活的页码导航。

---

## 功能特点

### 1. ✅ 每页显示数量可调
- 10条/页（默认）
- 20条/页
- 50条/页
- 100条/页

### 2. ✅ 完整的分页控制
- 首页按钮
- 上一页按钮
- 页码按钮（最多显示7个）
- 下一页按钮
- 末页按钮

### 3. ✅ 智能页码显示
- 总页数 ≤ 7：显示所有页码
- 当前页靠前：显示 1-7
- 当前页靠后：显示最后7页
- 当前页居中：显示当前页前后各3页

### 4. ✅ 统计信息
- 显示总记录数
- 显示当前页/总页数
- 实时更新

### 5. ✅ 与筛选联动
- 筛选后自动重置到第一页
- 分页数据根据筛选结果计算
- 筛选和分页完美配合

---

## 界面展示

```
┌─────────────────────────────────────────────────────────────┐
│  [表格内容]                                                  │
│  ...                                                         │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  每页显示 [10▼] 条    共 156 条记录                         │
│                                                              │
│  [首页] [上一页] [1] [2] [3] [4] [5] [6] [7] [下一页] [末页] │
│                                    第 3 / 16 页              │
└─────────────────────────────────────────────────────────────┘
```

---

## 技术实现

### 状态管理

```javascript
const [currentPage, setCurrentPage] = useState(1)      // 当前页码
const [pageSize, setPageSize] = useState(10)           // 每页显示数量
const [totalPages, setTotalPages] = useState(0)        // 总页数
```

### 分页计算

```javascript
// 计算总页数
setTotalPages(Math.ceil(filteredEmployees.length / pageSize))

// 获取当前页数据
const getCurrentPageData = () => {
  const startIndex = (currentPage - 1) * pageSize
  const endIndex = startIndex + pageSize
  return filteredEmployees.slice(startIndex, endIndex)
}
```

### 页码显示逻辑

```javascript
// 智能显示页码（最多7个）
if (totalPages <= 7) {
  // 显示所有页码
  pageNum = i + 1
} else if (currentPage <= 4) {
  // 当前页靠前，显示 1-7
  pageNum = i + 1
} else if (currentPage >= totalPages - 3) {
  // 当前页靠后，显示最后7页
  pageNum = totalPages - 6 + i
} else {
  // 当前页居中，显示前后各3页
  pageNum = currentPage - 3 + i
}
```

### 与筛选联动

```javascript
useEffect(() => {
  // 筛选逻辑...
  setFilteredEmployees(filtered)
  setTotalPages(Math.ceil(filtered.length / pageSize))
  setCurrentPage(1) // 筛选后重置到第一页
}, [searchFilters, employees, pageSize])
```

---

## 使用示例

### 场景1：查看大量员工数据
1. 系统有200名员工
2. 默认每页显示10条
3. 共20页
4. 可以通过页码快速跳转

### 场景2：调整显示数量
1. 点击"每页显示"下拉框
2. 选择"50"
3. 页面自动刷新，显示50条数据
4. 总页数变为4页

### 场景3：筛选后分页
1. 筛选"技术部"员工（30人）
2. 自动跳转到第1页
3. 显示前10条技术部员工
4. 共3页

### 场景4：快速导航
1. 当前在第5页
2. 点击"首页"，跳转到第1页
3. 点击"末页"，跳转到最后一页
4. 点击页码"8"，跳转到第8页

---

## 分页按钮状态

### 禁用状态
- **首页/上一页**：当前在第1页时禁用
- **末页/下一页**：当前在最后一页时禁用

### 高亮状态
- **当前页码**：蓝绿色背景，白色文字
- **其他页码**：白色背景，灰色边框

### 悬停效果
- 所有可点击按钮：悬停时背景变浅灰色
- 禁用按钮：悬停无效果，透明度50%

---

## 样式说明

### 分页容器
```css
.mt-4                    /* 上边距 */
.flex                    /* 弹性布局 */
.items-center            /* 垂直居中 */
.justify-between         /* 两端对齐 */
.px-4                    /* 左右内边距 */
```

### 页码按钮
```css
/* 普通状态 */
.px-3 .py-1              /* 内边距 */
.border .border-gray-300 /* 边框 */
.rounded-lg              /* 圆角 */
.hover:bg-gray-50        /* 悬停效果 */

/* 当前页 */
.bg-primary-500          /* 主题色背景 */
.text-white              /* 白色文字 */
.border-primary-500      /* 主题色边框 */

/* 禁用状态 */
.disabled:opacity-50     /* 半透明 */
.disabled:cursor-not-allowed /* 禁止光标 */
```

---

## 性能优化

### 1. 前端分页
- 一次性加载所有数据
- 前端进行分页切割
- 适合数据量 < 1000 条

### 2. 优化建议
如果员工数量超过1000人，建议改为后端分页：

```javascript
// 后端API支持分页参数
const fetchEmployees = async (page, size) => {
  const response = await fetch(
    `http://localhost:3001/api/employees?page=${page}&size=${size}`
  )
  const data = await response.json()
  setEmployees(data.list)
  setTotalPages(data.totalPages)
}
```

### 3. 虚拟滚动
数据量特别大时（>5000条），可以考虑使用虚拟滚动：
- react-window
- react-virtualized

---

## 用户体验

### 1. 响应速度
- ✅ 页码切换：即时响应
- ✅ 每页数量调整：即时响应
- ✅ 筛选后分页：自动重置

### 2. 视觉反馈
- ✅ 当前页高亮显示
- ✅ 禁用按钮半透明
- ✅ 悬停效果明显

### 3. 操作便捷
- ✅ 首页/末页快速跳转
- ✅ 上一页/下一页连续翻页
- ✅ 页码直接点击跳转

---

## 常见问题

### Q: 为什么筛选后跳到第一页？
A: 这是正常行为。筛选改变了数据集，自动重置到第一页以显示筛选结果。

### Q: 页码最多显示几个？
A: 最多显示7个页码按钮，超过7页会智能显示当前页附近的页码。

### Q: 可以自定义每页数量吗？
A: 可以，在下拉框中选择10/20/50/100条。

### Q: 数据量很大会卡吗？
A: 当前是前端分页，数据量<1000条时性能良好。超过1000条建议改为后端分页。

### Q: 分页信息会保存吗？
A: 当前不保存，刷新页面会重置。如需保存可以使用localStorage。

---

## 扩展功能（可选）

### 1. 跳转到指定页
```jsx
<input
  type="number"
  min="1"
  max={totalPages}
  placeholder="页码"
  onKeyPress={(e) => {
    if (e.key === 'Enter') {
      handlePageChange(Number(e.target.value))
    }
  }}
/>
```

### 2. 保存分页状态
```javascript
// 保存到localStorage
useEffect(() => {
  localStorage.setItem('employeePage', currentPage)
  localStorage.setItem('employeePageSize', pageSize)
}, [currentPage, pageSize])

// 恢复状态
useEffect(() => {
  const savedPage = localStorage.getItem('employeePage')
  const savedSize = localStorage.getItem('employeePageSize')
  if (savedPage) setCurrentPage(Number(savedPage))
  if (savedSize) setPageSize(Number(savedSize))
}, [])
```

### 3. 后端分页API
```javascript
// 后端路由
fastify.get('/api/employees', async (request, reply) => {
  const { page = 1, size = 10 } = request.query
  const offset = (page - 1) * size

  const [rows] = await pool.query(
    'SELECT * FROM employees LIMIT ? OFFSET ?',
    [size, offset]
  )

  const [countResult] = await pool.query(
    'SELECT COUNT(*) as total FROM employees'
  )

  return {
    list: rows,
    total: countResult[0].total,
    page: Number(page),
    size: Number(size),
    totalPages: Math.ceil(countResult[0].total / size)
  }
})
```

---

## 相关文件

- `src/components/EmployeeManagement.jsx` - 员工管理组件（已添加分页）

---

**更新时间**：2024-11-09
**版本**：v2.4.0
