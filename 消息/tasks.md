# 通知系统开发任务列表

## 阶段一：数据库设计与后端基础 ✅

### 任务 1.1: 数据库表设计
- [x] 创建 `notifications` 表
  - id (主键)
  - type (系统/部门/人员)
  - title (标题)
  - content (内容)
  - content_type (文本/富文本/图片/链接/混合)
  - image_url (图片链接)
  - link_url (跳转链接)
  - priority (优先级: 低/中/高/紧急)
  - sender_id (发送者ID)
  - department_id (部门ID，可为空)
  - created_at (创建时间)
  - expires_at (过期时间)
  - status (启用/禁用)

- [x] 创建 `notification_recipients` 表（通知接收者关联表）
  - id (主键)
  - notification_id (通知ID)
  - user_id (用户ID)
  - is_read (是否已读)
  - read_at (阅读时间)
  - is_deleted (是否删除)
  - created_at (创建时间)

### 任务 1.2: 后端 API 路由设计
- [x] POST `/api/notifications` - 创建通知
- [x] GET `/api/notifications` - 获取当前用户的通知列表
- [x] GET `/api/notifications/unread` - 获取未读通知
- [x] PUT `/api/notifications/:id/read` - 标记为已读
- [x] PUT `/api/notifications/read-all` - 全部标记为已读
- [x] DELETE `/api/notifications/:id` - 删除通知
- [x] GET `/api/notifications/history` - 获取历史通知

### 任务 1.3: 通知创建逻辑
- [x] 实现系统通知（发送给所有用户）
- [x] 实现部门通知（根据部门ID查询用户）
- [x] 实现人员通知（指定用户ID列表）
- [x] 通知权限验证（管理员/部门主管）
- [x] 通知内容验证和过滤

## 阶段二：WebSocket 实时推送 ✅

### 任务 2.1: WebSocket 服务端
- [ ] 集成 Socket.IO 到后端
- [ ] 用户连接管理（用户ID与Socket映射）
- [ ] 实现通知推送事件
  - `notification:new` - 新通知
  - `notification:update` - 通知更新
  - `notification:delete` - 通知删除

### 任务 2.2: 通知推送逻辑
- [ ] 创建通知后自动推送给目标用户
- [ ] 支持批量推送
- [ ] 离线用户通知缓存
- [ ] 推送失败重试机制

## 阶段三：前端通知组件 ✅

### 任务 3.1: 通知弹出框组件 (NotificationToast)
- [ ] 创建基础 Toast 组件
  - 右下角定位
  - 进入/退出动画
  - 自动关闭（可配置时间）
  - 手动关闭按钮

- [ ] 支持不同内容类型渲染
  - 纯文本
  - 富文本（HTML）
  - 图片展示
  - 链接按钮
  - 混合内容

- [ ] 通知优先级样式
  - 低优先级：灰色
  - 中优先级：蓝色
  - 高优先级：橙色
  - 紧急：红色

### 任务 3.2: 通知队列管理
- [ ] 实现通知队列（最多显示3-5条）
- [ ] 通知堆叠显示
- [ ] 队列满时的处理策略
- [ ] 通知自动消失逻辑

### 任务 3.3: 通知中心组件
- [ ] 创建通知中心页面/抽屉
- [ ] 通知列表展示
  - 未读/已读标识
  - 时间显示
  - 分页加载
- [ ] 筛选功能（全部/未读/已读）
- [ ] 批量操作（全部已读/删除）

### 任务 3.4: 通知图标和徽章
- [ ] 顶部导航栏通知图标
- [ ] 未读数量徽章
- [ ] 点击打开通知中心
- [ ] 实时更新未读数

## 阶段四：WebSocket 客户端集成 ✅

### 任务 4.1: Socket.IO 客户端
- [ ] 安装和配置 Socket.IO 客户端
- [ ] 用户登录后建立 WebSocket 连接
- [ ] 监听通知事件
- [ ] 断线重连机制

### 任务 4.2: 通知接收处理
- [ ] 接收新通知并显示 Toast
- [ ] 更新通知中心列表
- [ ] 更新未读数量
- [ ] 播放通知音效（可选）

## 阶段五：通知管理后台 ✅

### 任务 5.1: 通知发送页面
- [ ] 创建通知发送表单
  - 通知类型选择（系统/部门/人员）
  - 标题输入
  - 内容编辑器（支持富文本）
  - 图片上传
  - 链接输入
  - 优先级选择
  - 目标选择（部门/用户）
  - 过期时间设置

### 任务 5.2: 通知历史管理
- [ ] 已发送通知列表
- [ ] 通知详情查看
- [ ] 通知统计（已读/未读人数）
- [ ] 通知编辑/删除

### 任务 5.3: 权限控制
- [ ] 管理员可发送系统通知
- [ ] 部门主管可发送部门通知
- [ ] 限制普通用户发送权限

## 阶段六：高级功能 ✅

### 任务 6.1: 通知模板
- [ ] 创建常用通知模板
- [ ] 模板变量替换（如：用户名、日期等）
- [ ] 模板管理（增删改查）

### 任务 6.2: 通知设置
- [ ] 用户通知偏好设置
  - 是否接收系统通知
  - 是否接收部门通知
  - 通知音效开关
  - 免打扰时间段
- [ ] 通知显示时长配置

### 任务 6.3: 通知统计
- [ ] 通知发送统计
- [ ] 阅读率统计
- [ ] 用户活跃度分析

## 阶段七：测试与优化 ✅

### 任务 7.1: 功能测试
- [ ] 各类型通知发送测试
- [ ] 实时推送测试
- [ ] 多用户并发测试
- [ ] 离线通知测试

### 任务 7.2: 性能优化
- [ ] 通知列表分页优化
- [ ] WebSocket 连接池优化
- [ ] 数据库查询优化
- [ ] 前端渲染性能优化

### 任务 7.3: 用户体验优化
- [ ] 动画效果调优
- [ ] 响应式适配
- [ ] 无障碍访问支持
- [ ] 错误处理和提示

## 技术栈

### 后端
- Node.js + Express
- Socket.IO (WebSocket)
- MySQL (数据存储)
- JWT (身份验证)

### 前端
- React
- Ant Design (UI 组件)
- Socket.IO Client
- React Transition Group (动画)

## 预估工期
- 阶段一：2天
- 阶段二：1天
- 阶段三：3天
- 阶段四：1天
- 阶段五：2天
- 阶段六：2天
- 阶段七：2天

**总计：约 13 个工作日**
